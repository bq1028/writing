<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <style>*{box-sizing:border-box}body{margin:0;font-family:system-ui,sans-serif}</style>
    <title data-head="true">Color Palette Documentation for Living Style Guides</title><meta name="description" content="The personal blog of Brent Jackson" data-head="true"/><meta name="author" content="Brent Jackson" data-head="true"/><meta name="twitter:card" content="summary" data-head="true"/><meta name="twitter:site" content="@jxnblk" data-head="true"/><meta name="twitter:title" content="Color Palette Documentation for Living Style Guides" data-head="true"/><meta name="twitter:image" content="https://jxnblk.com/avatar.png" data-head="true"/><style data-styled-components="dUiVDW dAnclP ffIkcW iHZvIS fsERgr eSJKuO heJdfs ihezuW dprmrz kgOQiB jWPlsU kLDilu kjJiZl dTSnFq iQjkbY hKiLMS">
/* sc-component-id: sc-bdVaJa */
.sc-bdVaJa {} .ffIkcW{box-sizing:border-box;margin-left:auto;margin-right:auto;padding-bottom:128px;padding-left:16px;padding-right:16px;}.iHZvIS{box-sizing:border-box;}.fsERgr{line-height:1.625;box-sizing:border-box;margin-right:0px;-webkit-flex:none;-ms-flex:none;flex:none;} @media screen and (min-width:32em){.fsERgr{margin-right:0px;}} @media screen and (min-width:48em){.fsERgr{margin-right:256px;}}.eSJKuO{box-sizing:border-box;margin-top:128px;}
/* sc-component-id: sc-bwzfXH */
.sc-bwzfXH {} .hKiLMS{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}
/* sc-component-id: sc-bxivhb */
.sc-bxivhb {} .dUiVDW{font-family:system-ui,sans-serif;} .dUiVDW *{box-sizing:border-box;}
/* sc-component-id: sc-htoDjs */
.sc-htoDjs {} .dTSnFq{color:#0067ee;}
/* sc-component-id: sc-iwsKbI */
.sc-iwsKbI {} .heJdfs{color:inherit;display:block;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: sc-gqjmRU */
.sc-gqjmRU {} .jWPlsU{margin:0px;margin-bottom:32px;margin-top:16px;line-height:1.625;} ul .jWPlsU{margin-top:0;margin-bottom:0;}
/* sc-component-id: sc-VigVT */
.sc-VigVT {} .ihezuW{font-size:32px;font-weight:700;line-height:1.25;margin:0px;margin-bottom:64px;margin-top:64px;}.dprmrz{font-size:32px;font-weight:700;line-height:1.25;margin:0px;margin-bottom:16px;margin-top:32px;} @media screen and (min-width:32em){.dprmrz{font-size:48px;}}.kgOQiB{font-size:24px;font-weight:700;line-height:1.25;margin:0px;margin-bottom:16px;margin-top:32px;} @media screen and (min-width:32em){.kgOQiB{font-size:32px;}}
/* sc-component-id: sc-kGXeez */
.sc-kGXeez {} .kLDilu{font-size:14px;font-family:"SF Mono","Roboto Mono",Menlo,monospace;margin:0px;margin-bottom:32px;margin-top:32px;padding:16px;overflow:auto;background-color:#eee;}.kjJiZl{font-size:14px;font-family:"SF Mono","Roboto Mono",Menlo,monospace;margin:0px;margin-top:32px;overflow:auto;}
/* sc-component-id: sc-kpOJdX */
.sc-kpOJdX {} .iQjkbY{font-size:inherit;font-family:"SF Mono","Roboto Mono",Menlo,monospace;}
/* sc-component-id: sc-jAaTju */
.sc-jAaTju {} .dAnclP{margin-left:auto;margin-right:auto;padding-bottom:128px;padding-left:16px;padding-right:16px;max-width:1024px;}</style>
  </head>
  <body>
    <div id=root><div class="sc-bxivhb dUiVDW"><div class="sc-jAaTju dAnclP sc-bdVaJa ffIkcW sc-bdVaJa iHZvIS"><header><a class="sc-iwsKbI heJdfs" href="/writing/"><h1 class="sc-VigVT ihezuW" href="/">Jxnblk Writing</h1></a></header><main class="sc-bdVaJa fsERgr"><div><h1 class="sc-VigVT dprmrz" id="color-palette-documentation-for-living-style-guides"><a class="sc-iwsKbI heJdfs" href="#color-palette-documentation-for-living-style-guides">Color Palette Documentation for Living Style Guides</a></h1><p class="sc-gqjmRU jWPlsU">Virtually every style guide has a color palette section in its documentation.
Many times I’ve seen this documentation created manually, where every change to a color requires updating the values in two places – the stylesheet and the style guide.
This often leads to one falling out of sync with the other,
and makes maintaining a living style guide more difficult.</p><p class="sc-gqjmRU jWPlsU">The problem with this approach is that the values are being defined in two different places.
For a true living style guide, the code should serve as the single source of truth.
Extracting color values from CSS can help keep documentation in sync,
expose outdated colors, and point out opportunities for normalizing designs.</p><p class="sc-gqjmRU jWPlsU">The following will show how to use Node.js to build source-code-derived documentation for color palettes
and present color contrast values for each possible pairing as a guide for usage.</p><h2 class="sc-VigVT kgOQiB" id="initial-setup"><a class="sc-iwsKbI heJdfs" href="#initial-setup">Initial Setup</a></h2><p class="sc-gqjmRU jWPlsU">If you’re already using Node.js in your build system,
you can integrate this directly into your project.
For the purposes of this tutorial, create a new sandboxed project to experiment with.</p><pre class="sc-kGXeez kLDilu">mkdir color-documentation
cd color-documentation
npm init
</pre><p class="sc-gqjmRU jWPlsU">Install the following modules.</p><pre class="sc-kGXeez kLDilu">npm i --save-dev postcss color colorable lodash
</pre><p class="sc-gqjmRU jWPlsU">The <a class="sc-htoDjs dTSnFq" href="https://github.com/postcss/postcss">PostCSS</a> module will be used to transform the source CSS into an
<a href="http://en.wikipedia.org/wiki/Abstract_syntax_tree"><abbr title="Abstract Syntax Tree">AST</abbr></a>
for manipulation with JavaScript.
<a class="sc-htoDjs dTSnFq" href="https://www.npmjs.com/package/color">Color</a> will be used to convert the values found in the stylesheet to hexidecimal.
<a class="sc-htoDjs dTSnFq" href="http://jxnblk.com/colorable">Colorable</a> will be used to get color contrast values and
<a class="sc-htoDjs dTSnFq" href="http://www.w3.org/TR/WCAG20/#visual-audio-contrast">WCAG</a>
scores for every possible pairing of colors.
And <a class="sc-htoDjs dTSnFq" href="https://lodash.com/docs">lodash</a> will be used to find unique color values and
to render templates to HTML.</p><p class="sc-gqjmRU jWPlsU">Copy a CSS file into the project to use as a source for the color values.
This tutorial will use <a class="sc-htoDjs dTSnFq" href="http://www.basscss.com/docs/">Basscss</a> as an example.</p><h2 class="sc-VigVT kgOQiB" id="build-script"><a class="sc-iwsKbI heJdfs" href="#build-script">Build Script</a></h2><p class="sc-gqjmRU jWPlsU">Create a new <code class="sc-kpOJdX iQjkbY">build.js</code> file that will be used to read the CSS file and eventually to generate an HTML page.</p><pre class="sc-kGXeez kLDilu">// build.js
var fs = require(&#x27;fs&#x27;)

// Read the contents of basscss.css
var css = fs.readFileSync(&#x27;basscss.css&#x27;, &#x27;utf8&#x27;)

console.log(css)
</pre><p class="sc-gqjmRU jWPlsU">For now, this script just logs the stylesheet.</p><h2 class="sc-VigVT kgOQiB" id="package-scripts"><a class="sc-iwsKbI heJdfs" href="#package-scripts">Package Scripts</a></h2><p class="sc-gqjmRU jWPlsU">Add a script to <code class="sc-kpOJdX iQjkbY">package.json</code> for the build script.</p><pre class="sc-kGXeez kLDilu">// package.json
&quot;scripts&quot;: {
  &quot;start&quot;: &quot;node build&quot;
}
</pre><p class="sc-gqjmRU jWPlsU">Run the script to make sure everything is working.</p><pre class="sc-kGXeez kLDilu">npm start
</pre><h2 class="sc-VigVT kgOQiB" id="parsing-css"><a class="sc-iwsKbI heJdfs" href="#parsing-css">Parsing CSS</a></h2><p class="sc-gqjmRU jWPlsU">Create a new <code class="sc-kpOJdX iQjkbY">lib/parse-colors.js</code> file for parsing the CSS.</p><pre class="sc-kGXeez kLDilu">// lib/parse-colors.js
var _ = require(&#x27;lodash&#x27;)
var postcss = require(&#x27;postcss&#x27;)
var Color = require(&#x27;color&#x27;)

module.exports = function(css) {
  // Array of colors to return
  var colors = []

  // Parse the CSS file and get the AST
  var root = postcss.parse(css)

  // Iterate through each declaration and log the property
  root.eachDecl(function(decl) {
    console.log(decl.prop)
  })

  return colors
}
</pre><p class="sc-gqjmRU jWPlsU">Use this module in <code class="sc-kpOJdX iQjkbY">build.js</code>.</p><pre class="sc-kGXeez kLDilu">// build.js
var fs = require(&#x27;fs&#x27;)
var parseColors = require(&#x27;./lib/parse-colors&#x27;)

// Read the contents of basscss.css
var css = fs.readFileSync(&#x27;basscss.css&#x27;, &#x27;utf8&#x27;)
var colors = parseColors(css)
</pre><p class="sc-gqjmRU jWPlsU">The <code class="sc-kpOJdX iQjkbY">parse-colors</code> module takes raw CSS and transforms it into an AST that can be iterated over.
For now, this just logs all the properties found in the stylesheet.</p><h2 class="sc-VigVT kgOQiB" id="filtering-colors"><a class="sc-iwsKbI heJdfs" href="#filtering-colors">Filtering Colors</a></h2><p class="sc-gqjmRU jWPlsU">Next update the parse module to filter out everything but <code class="sc-kpOJdX iQjkbY">color</code> and <code class="sc-kpOJdX iQjkbY">background-color</code> properties,
convert the values to hex, and remove duplicates.
While color values can be used in other properties including the <code class="sc-kpOJdX iQjkbY">background</code> shorthand,
handling that would add complexity and will be omitted from this tutorial.</p><pre class="sc-kGXeez kLDilu">// lib/parse-colors.js
var _ = require(&#x27;lodash&#x27;)
var postcss = require(&#x27;postcss&#x27;)
var Color = require(&#x27;color&#x27;)

module.exports = function(css) {

  var colors = []
  var root = postcss.parse(css)

  // Iterate through each color and background-color declaration
  root.eachDecl(/(color|background-color)/, function(decl) {
    // Add each color value to the colors array
    colors.push(decl.value)
  })

  // Convert all color values to hex strings
  colors = colors.map(function(color) {
    var hex
    try {
      hex = Color(color).hexString()
      return hex
    } catch(e) {
      // Handle color values like inherit and currentcolor
      return false
    }
  })
  .filter(function(value) {
    // Remove false values
    return value
  })

  // Remove duplicate values
  colors = _.uniq(colors)

  return colors

}
</pre><p class="sc-gqjmRU jWPlsU">The first argument in <code class="sc-kpOJdX iQjkbY">root.eachDecl</code> is a regular expression to filter declarations for either <code class="sc-kpOJdX iQjkbY">color</code> or <code class="sc-kpOJdX iQjkbY">background-color</code>.
See the <a class="sc-htoDjs dTSnFq" href="https://github.com/postcss/postcss/blob/master/docs/api.md#containereachdeclpropfilter-callback">PostCSS documentation</a> for more details.
The <code class="sc-kpOJdX iQjkbY">Color().hexString()</code> method converts any valid color value to hex format. The lodash <code class="sc-kpOJdX iQjkbY">_.uniq</code> method removes duplicate values from an array.</p><h2 class="sc-VigVT kgOQiB" id="html-template"><a class="sc-iwsKbI heJdfs" href="#html-template">HTML Template</a></h2><p class="sc-gqjmRU jWPlsU">Next, create a <code class="sc-kpOJdX iQjkbY">template.html</code> file for displaying the colors.
This tutorial uses lodash templates, but any JavaScript templating language would work.
Note: if you’re using a stylesheet other than Basscss, the classes applied below may differ.</p><pre class="sc-kGXeez kLDilu">&lt;!DOCTYPE html&gt;
&lt;!-- template.html --&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;title&gt;Color Palette Docs Demo&lt;/title&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;basscss.css&quot;&gt;
&lt;/head&gt;
&lt;body class=&quot;px3&quot;&gt;
  &lt;header class=&quot;py3&quot;&gt;
    &lt;h1&gt;Color Palette Docs Demo&lt;/h1&gt;
  &lt;/header&gt;
  &lt;ul class=&quot;list-reset flex flex-wrap flex-justify mxn2&quot;&gt;
    &lt;% colors.map(renderColor) %&gt;
  &lt;/ul&gt;
  &lt;% function renderColor(color) { %&gt;
    &lt;li class=&quot;m2&quot;&gt;
      &lt;div style=&quot;background-color:&lt;%= color %&gt;&quot;
        class=&quot;p4&quot;&gt;&lt;/div&gt;
      &lt;%= color %&gt;
    &lt;/li&gt;
  &lt;% } %&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre><p class="sc-gqjmRU jWPlsU">Inside the <code class="sc-kpOJdX iQjkbY">&lt;ul&gt;</code> the <code class="sc-kpOJdX iQjkbY">.map()</code> method is used to iterate over the <code class="sc-kpOJdX iQjkbY">colors</code> array and passes the <code class="sc-kpOJdX iQjkbY">renderColor</code> function as a callback.
The <code class="sc-kpOJdX iQjkbY">renderColor</code> function then renders an <code class="sc-kpOJdX iQjkbY">&lt;li&gt;</code> for each color with a div that has its background color set to that value.</p><p class="sc-gqjmRU jWPlsU">Edit <code class="sc-kpOJdX iQjkbY">build.js</code> to read the template and generate an HTML file.</p><pre class="sc-kGXeez kLDilu">// build.js
var _ = require(&#x27;lodash&#x27;)
var fs = require(&#x27;fs&#x27;)
var parseColors = require(&#x27;./lib/parse-colors&#x27;)

var css = fs.readFileSync(&#x27;basscss.css&#x27;, &#x27;utf8&#x27;)
// Read the template string
var template = fs.readFileSync(&#x27;template.html&#x27;, &#x27;utf8&#x27;)
// Create a lodash template function
var tpl = _.template(template)
var colors = parseColors(css)

// Render the template function to an HTML string
var html = tpl({ colors: colors })

// Write an HTML file to disk
fs.writeFileSync(&#x27;index.html&#x27;, html)
</pre><p class="sc-gqjmRU jWPlsU">Now run <code class="sc-kpOJdX iQjkbY">npm start</code> which should generate an HTML file with the colors parsed from the stylesheet.</p><pre class="sc-kGXeez kLDilu">npm start &amp;&amp; open index.html
</pre><img src="http://jxnblk.s3.amazonaws.com/assets/images/css-color-palette.png" alt="Color palette demo" width="768" height="496"/><h2 class="sc-VigVT kgOQiB" id="readable-color-combinations"><a class="sc-iwsKbI heJdfs" href="#readable-color-combinations">Readable Color Combinations</a></h2><p class="sc-gqjmRU jWPlsU">The Colorable module takes an array of colors and returns a nested array of color combinations, along with their contrast values to test for readability. This can be useful for seeing what foreground-background pairs can and can’t be used for text.</p><p class="sc-gqjmRU jWPlsU">Create a new <code class="sc-kpOJdX iQjkbY">lib/parse-combos.js</code> file.</p><pre class="sc-kGXeez kLDilu">// lib/parse-combos.js
var colorable = require(&#x27;colorable&#x27;)

module.exports = function(colors) {

  var combos = []
  // Get the Colorable array
  var arr = colorable(colors)

  // Flatten the array and combine the foreground and background colors
  arr.forEach(function(color) {
    var pairing = color.hex
    color.combinations.forEach(function(combo) {
      combo.pairing = pairing
      combos.push(combo)
    })
  })

  // Sort the array by contrast from high to low
  combos.sort(function(a, b) {
    return b.contrast - a.contrast
  })

  return combos

}
</pre><p class="sc-gqjmRU jWPlsU">Add the <code class="sc-kpOJdX iQjkbY">parse-combos</code> module to <code class="sc-kpOJdX iQjkbY">build.js</code> and pass the combos array into the template function.</p><pre class="sc-kGXeez kLDilu">// build.js
var _ = require(&#x27;lodash&#x27;)
var fs = require(&#x27;fs&#x27;)
var parseColors = require(&#x27;./lib/parse-colors&#x27;)
var parseCombos = require(&#x27;./lib/parse-combos&#x27;)

var css = fs.readFileSync(&#x27;basscss.css&#x27;, &#x27;utf8&#x27;)
var template = fs.readFileSync(&#x27;template.html&#x27;, &#x27;utf8&#x27;)
var tpl = _.template(template)
var colors = parseColors(css)
var combos = parseCombos(colors)

var html = tpl({
  colors: colors,
  combos: combos
})
fs.writeFileSync(&#x27;index.html&#x27;, html)
</pre><p class="sc-gqjmRU jWPlsU">Add a section to <code class="sc-kpOJdX iQjkbY">template.html</code> to display the color combinations.</p><pre class="sc-kGXeez kLDilu">  &lt;h2&gt;Combinations&lt;/h2&gt;
  &lt;ul class=&quot;list-reset flex flex-wrap&quot;&gt;
    &lt;% combos.map(renderCombo) %&gt;
  &lt;/ul&gt;
  &lt;% function renderCombo(combo) { %&gt;
    &lt;li class=&quot;py2 col-6 sm-col-4 md-col-3 lg-col-2&quot;
      style=&quot;color:&lt;%= combo.pairing %&gt;;background-color:&lt;%= combo.hex %&gt;&quot;&gt;
      &lt;div class=&quot;h1 bold px2&quot;&gt;
        Aa
      &lt;/div&gt;
      &lt;div class=&quot;h5 px2&quot;&gt;
        &lt;%= combo.pairing %&gt;
        &lt;br&gt;
        &lt;%= combo.hex %&gt;
        &lt;br&gt;
        &lt;%= combo.contrast.toFixed(2) %&gt;
      &lt;/div&gt;
    &lt;/li&gt;
  &lt;% } %&gt;
</pre><p class="sc-gqjmRU jWPlsU">Run the build script. You should now have a list of color combinations along with the contrast value for each pair.</p><img src="http://jxnblk.s3.amazonaws.com/assets/images/css-color-combos.jpg" alt="Color combination demo" width="768" height="576"/><p class="sc-gqjmRU jWPlsU">While seeing combinations that don’t have high enough contrast might be useful,
for this tutorial set Colorable’s <code class="sc-kpOJdX iQjkbY">threshold</code> option to 3
to only show combinations that pass the WCAG minimum for large text.</p><pre class="sc-kGXeez kLDilu">// lib/parse-combos.js
  // ...
  var combos = []
  var arr = colorable(colors, { threshold: 3 })
  // ...
</pre><p class="sc-gqjmRU jWPlsU">Run the build script again. Now you should only see color combinations with a contrast value of 3 or above.</p><p class="sc-gqjmRU jWPlsU">At this point, feel free to edit the styles of the rendered template and explore different ways of showing this information.
You can also swap <code class="sc-kpOJdX iQjkbY">basscss.css</code> out for another framework or stylesheet to test things out.</p><h2 class="sc-VigVT kgOQiB" id="expanding-upon-this-idea"><a class="sc-iwsKbI heJdfs" href="#expanding-upon-this-idea">Expanding Upon This Idea</a></h2><p class="sc-gqjmRU jWPlsU">In addition to displaying raw color values and contrast ratios,
other aspects of color can be extracted from a stylesheet,
such as the selectors used for each color or the number of times each color is used in a stylesheet.
You could also show colors sorted by similarity to help expose
inconsistencies and opportunities to normalize the design.</p><p class="sc-gqjmRU jWPlsU">While this is not a complete replacement for human written documentation,
and creating guidelines around color usage requires carefully considered writing,
using automated tooling to generate source-code-derived documentation
for things like color values can help create better living style guides.</p></div><pre class="sc-kGXeez kjJiZl">Mon Jun 15 2015</pre></main><footer><div class="sc-bwzfXH hKiLMS sc-bdVaJa eSJKuO sc-bdVaJa eSJKuO"><a class="sc-iwsKbI heJdfs" href="https://jxnblk.com">Made by Jxnblk</a></div></footer></div><script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,"script","//www.google-analytics.com/analytics.js","ga"); ga("create", "UA-4603832-6", "auto"); ga("send", "pageview");</script></div></div>
    
  </body>
</html>